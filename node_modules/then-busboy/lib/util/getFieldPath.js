"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _invariant = _interopRequireDefault(require("@octetstream/invariant"));

var _isString = _interopRequireDefault(require("./isString"));

var _getType = _interopRequireDefault(require("./getType"));

var _isNaN = _interopRequireDefault(require("./isNaN"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// Matched square braces notation paths
const BRACKET_EXPR = /^([^0-9[\]\n\r\t]+|\[[0-9]+\])(\[[^[\]]+\])*$/; // Matches dot notation paths

const DOT_EXPR = /^([a-z0-9_$]*)(?:\.([a-z0-9_$]*))*?$/i;

const fromDotNotation = string => string.split(".").map(key => (0, _isNaN.default)(key) ? key : Number(key));

function fromSquareBracesNotation(string) {
  const res = [];

  for (const element of string.split("[")) {
    if (element) {
      const key = element.endsWith("]") ? element.slice(0, -1) : element;
      res.push((0, _isNaN.default)(key) ? key : Number(key));
    }
  }

  return res;
}
/**
 * Get a fild path
 *
 * @param {string} fieldname
 *
 * @return {Array<string|number>}
 *
 * @throws {TypeError} when given fieldname is not a string
 * @throws {Error} on unexpected fieldname format
 *
 * @example
 *
 * getFieldPath("foo[bar][baz]") // -> ["foo", "bar", "baz"]
 *
 * getFieldPath("foo") // -> ["foo"]
 *
 * getFieldPath("[42]") // -> [42]
 *
 * getFieldPath("root.nested") // -> ["root", "nested"]
 *
 * getFieldPath("someCollection.0.name") // -> ["someCollection", 0, "name"]
 */


function getFieldPath(fieldname) {
  (0, _invariant.default)(!(0, _isString.default)(fieldname), TypeError, "Field name should be a string. Received %s", (0, _getType.default)(fieldname));
  (0, _invariant.default)(!fieldname, "Field name cannot be empty.");

  switch (true) {
    case DOT_EXPR.test(fieldname):
      return fromDotNotation(fieldname);

    case BRACKET_EXPR.test(fieldname):
      return fromSquareBracesNotation(fieldname);

    default:
      return (0, _invariant.default)(true, "Unexpected field name format: %s", fieldname);
  }
}

var _default = getFieldPath;
exports.default = _default;